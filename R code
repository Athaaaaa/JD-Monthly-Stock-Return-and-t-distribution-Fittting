# Read data
JD_data <- read.csv("JD.csv")

# Calculate the daily logarithmic rate of return
JD_data$Return <- c(NA, diff(log(JD_data$Adj.Close)))

# Remove rows containing NA
JD_data <- na.omit(JD_data)

# Output the calculated yield
print(JD_data$Return)

# Define the PDF of the Generalized t-distribution
dt_G <- function(x, params) {
  location <- params[1]
  scale <- params[2]
  shape <- params[3]
  return(dt((x - location) / scale, df = shape) / scale)
}

# Define the CDF of the Generalized t-distribution
pt_G <- function(q, location, scale, shape) {
  return(pt((q - location) / scale, df = shape))
}

# Define the negative log-likelihood function for Maximum Likelihood Estimation (MLE)
neg_log_likelihood <- function(params, data) {
  log_density <- sapply(data, function(x) log(dt_G(x, params)))
  return(-sum(log_density))
}

# Prepare return data and initial parameter estimates
returns_data <- JD_data$Return
initial_params <- c(location = mean(returns_data), scale = sd(returns_data), shape = 5)

# Perform MLE to estimate the parameters of the Generalized t-distribution
mle_result <- optim(par = initial_params, fn = neg_log_likelihood, data = returns_data,
                    method = "L-BFGS-B", lower = c(-Inf, 0.001, 2), upper = c(Inf, Inf, Inf))
mle_params <- mle_result$par

# Print the parameters estimated by MLE
cat("MLE Results:\n")
print(mle_params)

# Load the fitdistrplus package for additional fitting methods
library(fitdistrplus)

# Define the PDF and CDF for use with fitdistrplus
dt_G_fitdistr <- function(x, location, scale, shape) {
  return(dt((x - location) / scale, df = shape) / scale)
}
pt_G_fitdistr <- function(q, location, scale, shape) {
  return(pt((q - location) / scale, df = shape))
}

# Fit the distribution using fitdistrplus with initial parameter estimates
fit_result <- fitdist(JD_data$Return, "dt_G_fitdistr", start = list(location = mean(returns_data), scale = sd(returns_data), shape = 5))

# Print the parameters estimated by fitdistrplus
cat("\nfitdistrplus Results:\n")
print(fit_result$estimate)
